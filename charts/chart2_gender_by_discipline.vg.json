{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "background": "transparent",
  "width": "container",
  "height": 520,
  "data": {
    "url": "https://raw.githubusercontent.com/tylertancl/fit3179-a2/main/data/athletes.csv",
    "format": {"type": "csv"}
  },
  "params": [
    {
      "name": "discipline_select",
      "bind": {
        "input": "select",
        "options": ["All", "Archery", "Artistic Gymnastics", "Athletics", "Badminton", "Baseball", "Basketball", "Beach Volleyball", "Boxing", "Canoe Slalom", "Canoe Sprint", "Cycling BMX Freestyle", "Cycling BMX Racing", "Cycling Mountain Bike", "Cycling Road", "Cycling Track", "Diving", "Equestrian", "Fencing", "Football", "Golf", "Handball", "Hockey", "Judo", "Karate", "Marathon Swimming", "Modern Pentathlon", "Rhythmic Gymnastics", "Rowing", "Rugby Sevens", "Sailing", "Shooting", "Skateboarding", "Softball", "Sport Climbing", "Surfing", "Swimming", "Table Tennis", "Taekwondo", "Tennis", "Trampoline Gymnastics", "Triathlon", "Volleyball", "Water Polo", "Weightlifting", "Wrestling"],
        "name": "Select Discipline: "
      }
    }
  ],
  "transform": [
    {
      "calculate": "(datum.discipline)",
      "as": "Discipline"
    },
    {
      "calculate": "(datum.gender || null)",
      "as": "Gender"
    },
    {"calculate": "datum.gender == null ? 'Unknown' : datum.gender", "as": "Gender"},
    {"filter": "datum.discipline != null && datum.discipline != '' && datum.discipline != 'Unknown'"},
    {"filter": "discipline_select == null || discipline_select == 'All' || datum.discipline == discipline_select"},
    {
      "aggregate": [{"op": "count", "as": "Count"}],
      "groupby": ["Discipline", "Gender"]
    },
    {
      "window": [{"op": "sum", "field": "Count", "as": "Total"}],
      "frame": [null, null],
      "groupby": ["Discipline"]
    },
    {"calculate": "datum.Count / datum.Total", "as": "Percentage"}
  ],
  "mark": "bar",
  "encoding": {
  "y": {"field": "Discipline", "type": "nominal", "sort": {"field": "Discipline", "order": "ascending"}, "title": "Discipline"},
    "x": {
      "field": "Percentage",
      "type": "quantitative",
      "stack": "normalize",
      "title": "Share of Athletes",
      "axis": {"format": ".0%"}
    },
    "color": {
  "field": "Gender",
  "type": "nominal",
  "title": "Gender",
  "scale": {
    "domain": ["Male", "Female"],
    "range": ["#4C78A8", "#E15759"]
  }
},
    "tooltip": [
      {"field": "Discipline", "type": "nominal"},
      {"field": "Gender", "type": "nominal"},
      {"field": "Count", "type": "quantitative", "title": "Count"},
      {"field": "Percentage", "type": "quantitative", "title": "Percentage", "format": ".1%"}
    ]
  }
}
